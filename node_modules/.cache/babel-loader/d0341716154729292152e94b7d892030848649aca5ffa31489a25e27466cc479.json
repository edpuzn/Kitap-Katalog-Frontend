{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Security from './security.js';\nimport FormTag from '@/components/forms/FormTag';\nimport TextInput from '@/components/forms/TextInput';\nimport SelectInput from '@/components/forms/SelectInput';\nimport router from '@/router';\nimport notie from 'notie';\nexport default {\n  name: \"BookEdit\",\n  beforeMount() {\n    Security.requireToken();\n\n    // get book for edit if id > 0\n    if (this.$route.params.bookId > 0) {\n      // editing a book\n    } else {\n      // adding a book\n    }\n\n    // get list of authors for drop down\n    fetch(`process.env.VUE_APP_API_URL` + \"/admin/authors/all\", Security.requestOptions(\"\")).then(response => response.json()).then(data => {\n      if (data.error) {\n        this.$emit('error', data.message);\n      } else {\n        this.authors = data.data;\n      }\n    });\n  },\n  components: {\n    'form-tag': FormTag,\n    'text-input': TextInput,\n    'select-input': SelectInput\n  },\n  data() {\n    return {\n      book: {\n        id: 0,\n        title: \"\",\n        author_id: 0,\n        publication_year: null,\n        description: \"\",\n        cover: \"\",\n        slug: \"\",\n        genres: [],\n        genre_ids: []\n      },\n      authors: [],\n      imgPath: process.env.VUE_APP_IMAGE_URL,\n      genres: [{\n        value: 1,\n        text: \"Science Fiction\"\n      }, {\n        value: 2,\n        text: \"Fantasy\"\n      }, {\n        value: 3,\n        text: \"Romance\"\n      }, {\n        value: 4,\n        text: \"Thriller\"\n      }, {\n        value: 5,\n        text: \"Mystery\"\n      }, {\n        value: 6,\n        text: \"Horror\"\n      }, {\n        value: 7,\n        text: \"Classic\"\n      }]\n    };\n  },\n  methods: {\n    submitHandler() {\n      const payload = {\n        id: this.book.id,\n        title: this.book.title,\n        author_id: parseInt(this.book.author_id, 10),\n        publication_year: parseInt(this.book.publication_year, 10),\n        description: this.book.description,\n        cover: this.book.cover,\n        slug: this.book.slug,\n        genre_ids: this.book.genre_ids\n      };\n\n      // console.log(payload);\n\n      fetch(`${process.env.VUE_APP_API_URL}/admin/books/save`, Security.requestOptions(payload)).then(response => response.json()).then(data => {\n        if (data.error) {\n          this.$emit('error', data.message);\n        } else {\n          this.$emit('success', 'Changes saved');\n          router.push(\"/admin/books\");\n        }\n      }).catch(error => {\n        this.$emit('error', error);\n      });\n    },\n    loadCoverImage() {\n      // get a reference to the input using ref\n      const file = this.$refs.coverInput.files[0];\n\n      // encode the file using the FileReader API\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const base64String = reader.result.replace(\"data:\", \"\").replace(/^.+,/, \"\");\n        this.book.cover = base64String;\n        // alert(base64String);\n      };\n      reader.readAsDataURL(file);\n    },\n    confirmDelete(id) {\n      notie.confirm({\n        text: \"Are you sure you want to delete this book?\",\n        submitText: \"Delete\",\n        submitCallback: () => {\n          let payload = {\n            id: id\n          };\n          fetch(process.env.VUE_APP_API_URL + \"/admin/books/delete\", Security.requestOptions(payload)).then(response => response.json()).then(data => {\n            if (data.error) {\n              this.$emit('error', data.message);\n            } else {\n              this.$emit('success', \"Book deleted\");\n              router.push(\"/admin/books\");\n            }\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["Security","FormTag","TextInput","SelectInput","router","notie","name","beforeMount","requireToken","$route","params","bookId","fetch","requestOptions","then","response","json","data","error","$emit","message","authors","components","book","id","title","author_id","publication_year","description","cover","slug","genres","genre_ids","imgPath","process","env","VUE_APP_IMAGE_URL","value","text","methods","submitHandler","payload","parseInt","VUE_APP_API_URL","push","catch","loadCoverImage","file","$refs","coverInput","files","reader","FileReader","onloadend","base64String","result","replace","readAsDataURL","confirmDelete","confirm","submitText","submitCallback"],"sources":["/Users/ed1p_/MovieProject/frontend/src/components/BookEdit.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row\">\n      <div class=\"col\">\n        <h1 class=\"mt-3\">Add/Edit Book</h1>\n        <hr>\n\n        <form-tag @bookEditEvent=\"submitHandler\" name=\"bookForm\" event=\"bookEditEvent\">\n\n          <div v-if=\"this.book.slug !=''\" class=\"mb-3\">\n            <img :src=\"`${this.imgPath}/covers/${this.book.slug}.jpg`\" class=\"img-fluid img-thumbnail book-cover\" alt=\"cover\">\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"formFile\" class=\"form-label\">Cover Image</label>\n            <input v-if=\"this.book.id === 0\" ref=\"coverInput\" class=\"faorm-control\" type=\"file\" id=\"formFile\"\n                   required accept=\"image/jpeg\" @change=\"loadCoverImage\">\n            <input v-else ref=\"coverInput\" class=\"form-control\" type=\"file\" id=\"formFile\"\n                   accept=\"image/jpeg\" @change=\"loadCoverImage\">\n          </div>\n\n          <text-input\n              v-model=\"book.title\"\n              type=\"text\"\n              required=\"true\"\n              label=\"Title\"\n              :value=\"book.title\"\n              name=\"title\"></text-input>\n\n          <select-input\n              name=\"author-id\"\n              v-model=\"this.book.author_id\"\n              :items=\"this.authors\"\n              required=\"required\"\n              label=\"Author\"></select-input>\n\n          <text-input\n              v-model=\"book.publication_year\"\n              type=\"number\"\n              required=\"true\"\n              label=\"Publication Year\"\n              :value=\"book.publication_year\"\n              name=\"publication-year\"></text-input>\n\n          <div class=\"mb-3\">\n            <label for=\"description\" class=\"form-label\">Description</label>\n            <textarea required v-model=\"book.description\" class=\"form-control\" id=\"description\" rows=\"3\"></textarea>\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"genres\" class=\"form-label\">Genres</label>\n            <select ref=\"genres\"\n                    id=\"genres\"\n                    class=\"form-select\"\n                    required\n                    size=\"7\"\n                    v-model=\"this.book.genre_ids\"\n                    multiple>\n              <option v-for=\"g in this.genres\" :value=\"g.value\" :key=\"g.value\">\n                {{g.text}}\n              </option>\n            </select>\n          </div>\n\n          <hr>\n\n          <div class=\"float-start\">\n            <input type=\"submit\" class=\"btn btn-primary me-2\" value=\"Save\" />\n            <router-link to=\"/admin/books\" class=\"btn btn-outline-secondary\">Cancel</router-link>\n          </div>\n          <div class=\"float-end\">\n            <a v-if=\"this.book.id > 0\"\n               class=\"btn btn-danger\" href=\"javascript:void(0);\" @click=\"confirmDelete(this.book.id)\">\n              Delete\n            </a>\n          </div>\n\n\n\n        </form-tag>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Security from './security.js'\nimport FormTag from '@/components/forms/FormTag'\nimport TextInput from '@/components/forms/TextInput'\nimport SelectInput from '@/components/forms/SelectInput'\nimport router from '@/router'\nimport notie from 'notie'\n\nexport default {\n  name: \"BookEdit\",\n  beforeMount() {\n    Security.requireToken();\n\n    // get book for edit if id > 0\n    if (this.$route.params.bookId > 0) {\n      // editing a book\n    } else {\n      // adding a book\n\n    }\n\n    // get list of authors for drop down\n    fetch(`process.env.VUE_APP_API_URL` + \"/admin/authors/all\", Security.requestOptions(\"\"))\n        .then((response) => response.json())\n        .then((data) => {\n          if (data.error) {\n            this.$emit('error', data.message);\n          } else {\n            this.authors = data.data;\n          }\n        })\n  },\n  components: {\n    'form-tag': FormTag,\n    'text-input': TextInput,\n    'select-input': SelectInput,\n  },\n  data() {\n    return {\n      book: {\n        id: 0,\n        title: \"\",\n        author_id: 0,\n        publication_year: null,\n        description: \"\",\n        cover: \"\",\n        slug: \"\",\n        genres: [],\n        genre_ids: [],\n      },\n      authors: [],\n      imgPath: process.env.VUE_APP_IMAGE_URL,\n      genres: [\n        {value: 1, text: \"Science Fiction\"},\n        {value: 2, text: \"Fantasy\"},\n        {value: 3, text: \"Romance\"},\n        {value: 4, text: \"Thriller\"},\n        {value: 5, text: \"Mystery\"},\n        {value: 6, text: \"Horror\"},\n        {value: 7, text: \"Classic\"},\n      ]\n    }\n  },\n  methods: {\n    submitHandler() {\n      const payload = {\n        id: this.book.id,\n        title: this.book.title,\n        author_id : parseInt(this.book.author_id, 10),\n        publication_year: parseInt(this.book.publication_year, 10),\n        description: this.book.description,\n        cover: this.book.cover,\n        slug: this.book.slug,\n        genre_ids: this.book.genre_ids,\n      }\n\n      // console.log(payload);\n\n      fetch(`${process.env.VUE_APP_API_URL}/admin/books/save`, Security.requestOptions(payload))\n          .then((response) => response.json())\n          .then((data) => {\n            if (data.error) {\n              this.$emit('error', data.message)\n            } else {\n              this.$emit('success', 'Changes saved');\n              router.push(\"/admin/books\");\n            }\n          })\n          .catch((error) =>{\n            this.$emit('error', error);\n          })\n    },\n    loadCoverImage() {\n      // get a reference to the input using ref\n      const file = this.$refs.coverInput.files[0];\n\n      // encode the file using the FileReader API\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const base64String = reader.result\n            .replace(\"data:\", \"\")\n            .replace(/^.+,/, \"\");\n        this.book.cover = base64String;\n        // alert(base64String);\n      }\n      reader.readAsDataURL(file);\n    },\n    confirmDelete(id) {\n      notie.confirm({\n        text: \"Are you sure you want to delete this book?\",\n        submitText: \"Delete\",\n        submitCallback: () => {\n          let payload = {\n            id: id,\n          }\n\n          fetch(process.env.VUE_APP_API_URL + \"/admin/books/delete\", Security.requestOptions(payload))\n              .then((response) => response.json())\n              .then((data) => {\n                if (data.error) {\n                  this.$emit('error', data.message);\n                } else {\n                  this.$emit('success', \"Book deleted\");\n                  router.push(\"/admin/books\");\n                }\n              })\n        }\n      })\n    }\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}