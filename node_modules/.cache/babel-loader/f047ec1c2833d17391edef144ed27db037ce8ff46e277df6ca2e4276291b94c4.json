{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, createTextVNode as _createTextVNode, withCtx as _withCtx } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"row\"\n};\nconst _hoisted_3 = {\n  class: \"col\"\n};\nconst _hoisted_4 = /*#__PURE__*/_createElementVNode(\"h1\", {\n  class: \"mt-3\"\n}, \"Add/Edit Book\", -1 /* HOISTED */);\nconst _hoisted_5 = /*#__PURE__*/_createElementVNode(\"hr\", null, null, -1 /* HOISTED */);\nconst _hoisted_6 = {\n  key: 0,\n  class: \"mb-3\"\n};\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  class: \"mb-3\"\n};\nconst _hoisted_9 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"formFile\",\n  class: \"form-label\"\n}, \"Cover Image\", -1 /* HOISTED */);\nconst _hoisted_10 = {\n  class: \"mb-3\"\n};\nconst _hoisted_11 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"description\",\n  class: \"form-label\"\n}, \"Description\", -1 /* HOISTED */);\nconst _hoisted_12 = {\n  class: \"mb-3\"\n};\nconst _hoisted_13 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"genres\",\n  class: \"form-label\"\n}, \"Genres\", -1 /* HOISTED */);\nconst _hoisted_14 = [\"value\"];\nconst _hoisted_15 = /*#__PURE__*/_createElementVNode(\"hr\", null, null, -1 /* HOISTED */);\nconst _hoisted_16 = {\n  class: \"float-start\"\n};\nconst _hoisted_17 = /*#__PURE__*/_createElementVNode(\"input\", {\n  type: \"submit\",\n  class: \"btn btn-primary me-2\",\n  value: \"Save\"\n}, null, -1 /* HOISTED */);\nconst _hoisted_18 = {\n  class: \"float-end\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_text_input = _resolveComponent(\"text-input\");\n  const _component_select_input = _resolveComponent(\"select-input\");\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_form_tag = _resolveComponent(\"form-tag\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_hoisted_4, _hoisted_5, _createVNode(_component_form_tag, {\n    onBookEditEvent: $options.submitHandler,\n    name: \"bookForm\",\n    event: \"bookEditEvent\"\n  }, {\n    default: _withCtx(() => [this.book.slug != '' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createElementVNode(\"img\", {\n      src: `${this.imgPath}/covers/${this.book.slug}.jpg`,\n      class: \"img-fluid img-thumbnail book-cover\",\n      alt: \"cover\"\n    }, null, 8 /* PROPS */, _hoisted_7)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_8, [_hoisted_9, this.book.id === 0 ? (_openBlock(), _createElementBlock(\"input\", {\n      key: 0,\n      ref: \"coverInput\",\n      class: \"faorm-control\",\n      type: \"file\",\n      id: \"formFile\",\n      required: \"\",\n      accept: \"image/jpeg\",\n      onChange: _cache[0] || (_cache[0] = (...args) => $options.loadCoverImage && $options.loadCoverImage(...args))\n    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)) : (_openBlock(), _createElementBlock(\"input\", {\n      key: 1,\n      ref: \"coverInput\",\n      class: \"form-control\",\n      type: \"file\",\n      id: \"formFile\",\n      accept: \"image/jpeg\",\n      onChange: _cache[1] || (_cache[1] = (...args) => $options.loadCoverImage && $options.loadCoverImage(...args))\n    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */))]), _createVNode(_component_text_input, {\n      modelValue: $data.book.title,\n      \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.book.title = $event),\n      type: \"text\",\n      required: \"true\",\n      label: \"Title\",\n      value: $data.book.title,\n      name: \"title\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"value\"]), _createVNode(_component_select_input, {\n      name: \"author-id\",\n      modelValue: this.book.author_id,\n      \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => this.book.author_id = $event),\n      items: this.authors,\n      required: \"required\",\n      label: \"Author\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"items\"]), _createVNode(_component_text_input, {\n      modelValue: $data.book.publication_year,\n      \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.book.publication_year = $event),\n      type: \"number\",\n      required: \"true\",\n      label: \"Publication Year\",\n      value: $data.book.publication_year,\n      name: \"publication-year\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"value\"]), _createElementVNode(\"div\", _hoisted_10, [_hoisted_11, _withDirectives(_createElementVNode(\"textarea\", {\n      required: \"\",\n      \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.book.description = $event),\n      class: \"form-control\",\n      id: \"description\",\n      rows: \"3\"\n    }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.book.description]])]), _createElementVNode(\"div\", _hoisted_12, [_hoisted_13, _withDirectives(_createElementVNode(\"select\", {\n      ref: \"genres\",\n      id: \"genres\",\n      class: \"form-select\",\n      required: \"\",\n      size: \"7\",\n      \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => this.book.genre_ids = $event),\n      multiple: \"\"\n    }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(this.genres, g => {\n      return _openBlock(), _createElementBlock(\"option\", {\n        value: g.value,\n        key: g.value\n      }, _toDisplayString(g.text), 9 /* TEXT, PROPS */, _hoisted_14);\n    }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, this.book.genre_ids]])]), _hoisted_15, _createElementVNode(\"div\", _hoisted_16, [_hoisted_17, _createVNode(_component_router_link, {\n      to: \"/admin/books\",\n      class: \"btn btn-outline-secondary\"\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"Cancel\")]),\n      _: 1 /* STABLE */\n    })]), _createElementVNode(\"div\", _hoisted_18, [this.book.id > 0 ? (_openBlock(), _createElementBlock(\"a\", {\n      key: 0,\n      class: \"btn btn-danger\",\n      href: \"javascript:void(0);\",\n      onClick: _cache[7] || (_cache[7] = $event => $options.confirmDelete(this.book.id))\n    }, \" Delete \")) : _createCommentVNode(\"v-if\", true)])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onBookEditEvent\"])])])]);\n}","map":{"version":3,"names":["class","_createElementVNode","key","for","type","value","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_createVNode","_component_form_tag","onBookEditEvent","$options","submitHandler","name","event","default","_withCtx","book","slug","_hoisted_6","src","imgPath","alt","_hoisted_7","_createCommentVNode","_hoisted_8","_hoisted_9","id","ref","required","accept","onChange","_cache","args","loadCoverImage","_component_text_input","modelValue","$data","title","$event","label","_component_select_input","author_id","items","authors","publication_year","_hoisted_10","_hoisted_11","description","rows","_hoisted_12","_hoisted_13","size","genre_ids","multiple","_Fragment","_renderList","genres","g","text","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_component_router_link","to","_createTextVNode","_","_hoisted_18","href","onClick","confirmDelete"],"sources":["/Users/ed1p_/MovieProject/frontend/src/components/BookEdit.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row\">\n      <div class=\"col\">\n        <h1 class=\"mt-3\">Add/Edit Book</h1>\n        <hr>\n\n        <form-tag @bookEditEvent=\"submitHandler\" name=\"bookForm\" event=\"bookEditEvent\">\n\n          <div v-if=\"this.book.slug !=''\" class=\"mb-3\">\n            <img :src=\"`${this.imgPath}/covers/${this.book.slug}.jpg`\" class=\"img-fluid img-thumbnail book-cover\" alt=\"cover\">\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"formFile\" class=\"form-label\">Cover Image</label>\n            <input v-if=\"this.book.id === 0\" ref=\"coverInput\" class=\"faorm-control\" type=\"file\" id=\"formFile\"\n                   required accept=\"image/jpeg\" @change=\"loadCoverImage\">\n            <input v-else ref=\"coverInput\" class=\"form-control\" type=\"file\" id=\"formFile\"\n                   accept=\"image/jpeg\" @change=\"loadCoverImage\">\n          </div>\n\n          <text-input\n              v-model=\"book.title\"\n              type=\"text\"\n              required=\"true\"\n              label=\"Title\"\n              :value=\"book.title\"\n              name=\"title\"></text-input>\n\n          <select-input\n              name=\"author-id\"\n              v-model=\"this.book.author_id\"\n              :items=\"this.authors\"\n              required=\"required\"\n              label=\"Author\"></select-input>\n\n          <text-input\n              v-model=\"book.publication_year\"\n              type=\"number\"\n              required=\"true\"\n              label=\"Publication Year\"\n              :value=\"book.publication_year\"\n              name=\"publication-year\"></text-input>\n\n          <div class=\"mb-3\">\n            <label for=\"description\" class=\"form-label\">Description</label>\n            <textarea required v-model=\"book.description\" class=\"form-control\" id=\"description\" rows=\"3\"></textarea>\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"genres\" class=\"form-label\">Genres</label>\n            <select ref=\"genres\"\n                    id=\"genres\"\n                    class=\"form-select\"\n                    required\n                    size=\"7\"\n                    v-model=\"this.book.genre_ids\"\n                    multiple>\n              <option v-for=\"g in this.genres\" :value=\"g.value\" :key=\"g.value\">\n                {{g.text}}\n              </option>\n            </select>\n          </div>\n\n          <hr>\n\n          <div class=\"float-start\">\n            <input type=\"submit\" class=\"btn btn-primary me-2\" value=\"Save\" />\n            <router-link to=\"/admin/books\" class=\"btn btn-outline-secondary\">Cancel</router-link>\n          </div>\n          <div class=\"float-end\">\n            <a v-if=\"this.book.id > 0\"\n               class=\"btn btn-danger\" href=\"javascript:void(0);\" @click=\"confirmDelete(this.book.id)\">\n              Delete\n            </a>\n          </div>\n\n\n\n        </form-tag>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Security from './security.js'\nimport FormTag from '@/components/forms/FormTag'\nimport TextInput from '@/components/forms/TextInput'\nimport SelectInput from '@/components/forms/SelectInput'\nimport router from '@/router'\nimport notie from 'notie'\n\nexport default {\n  name: \"BookEdit\",\n  beforeMount() {\n    Security.requireToken();\n\n    // get book for edit if id > 0\n    if (this.$route.params.bookId > 0) {\n      // editing a book\n    } else {\n      // adding a book\n\n    }\n\n    // get list of authors for drop down\n    fetch(`process.env.VUE_APP_API_URL` + \"/admin/authors/all\", Security.requestOptions(\"\"))\n        .then((response) => response.json())\n        .then((data) => {\n          if (data.error) {\n            this.$emit('error', data.message);\n          } else {\n            this.authors = data.data;\n          }\n        })\n  },\n  components: {\n    'form-tag': FormTag,\n    'text-input': TextInput,\n    'select-input': SelectInput,\n  },\n  data() {\n    return {\n      book: {\n        id: 0,\n        title: \"\",\n        author_id: 0,\n        publication_year: null,\n        description: \"\",\n        cover: \"\",\n        slug: \"\",\n        genres: [],\n        genre_ids: [],\n      },\n      authors: [],\n      imgPath: process.env.VUE_APP_IMAGE_URL,\n      genres: [\n        {value: 1, text: \"Science Fiction\"},\n        {value: 2, text: \"Fantasy\"},\n        {value: 3, text: \"Romance\"},\n        {value: 4, text: \"Thriller\"},\n        {value: 5, text: \"Mystery\"},\n        {value: 6, text: \"Horror\"},\n        {value: 7, text: \"Classic\"},\n      ]\n    }\n  },\n  methods: {\n    submitHandler() {\n      const payload = {\n        id: this.book.id,\n        title: this.book.title,\n        author_id : parseInt(this.book.author_id, 10),\n        publication_year: parseInt(this.book.publication_year, 10),\n        description: this.book.description,\n        cover: this.book.cover,\n        slug: this.book.slug,\n        genre_ids: this.book.genre_ids,\n      }\n\n      // console.log(payload);\n\n      fetch(`${process.env.VUE_APP_API_URL}/admin/books/save`, Security.requestOptions(payload))\n          .then((response) => response.json())\n          .then((data) => {\n            if (data.error) {\n              this.$emit('error', data.message)\n            } else {\n              this.$emit('success', 'Changes saved');\n              router.push(\"/admin/books\");\n            }\n          })\n          .catch((error) =>{\n            this.$emit('error', error);\n          })\n    },\n    loadCoverImage() {\n      // get a reference to the input using ref\n      const file = this.$refs.coverInput.files[0];\n\n      // encode the file using the FileReader API\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const base64String = reader.result\n            .replace(\"data:\", \"\")\n            .replace(/^.+,/, \"\");\n        this.book.cover = base64String;\n        // alert(base64String);\n      }\n      reader.readAsDataURL(file);\n    },\n    confirmDelete(id) {\n      notie.confirm({\n        text: \"Are you sure you want to delete this book?\",\n        submitText: \"Delete\",\n        submitCallback: () => {\n          let payload = {\n            id: id,\n          }\n\n          fetch(process.env.VUE_APP_API_URL + \"/admin/books/delete\", Security.requestOptions(payload))\n              .then((response) => response.json())\n              .then((data) => {\n                if (data.error) {\n                  this.$emit('error', data.message);\n                } else {\n                  this.$emit('success', \"Book deleted\");\n                  router.push(\"/admin/books\");\n                }\n              })\n        }\n      })\n    }\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}