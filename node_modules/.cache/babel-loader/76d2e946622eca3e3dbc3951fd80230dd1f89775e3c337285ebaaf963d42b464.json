{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Security from \"@/components/security\";\nimport FormTag from \"@/components/forms/FormTag.vue\";\nimport TextInput from \"@/components/forms/TextInput.vue\";\nimport SelectInput from \"@/components/forms/SelectInput.vue\";\nimport router from \"@/router\";\nimport notie from \"notie/dist/notie\";\nexport default {\n  name: \"BookEdit\",\n  beforeMount() {\n    Security.requireToken();\n  },\n  components: {\n    'form-tag': FormTag,\n    'text-input': TextInput,\n    'select-input': SelectInput\n  },\n  data() {\n    return {\n      book: {\n        id: 0,\n        title: \"\",\n        author_id: 0,\n        publication_year: 0,\n        description: \"\",\n        cover: \"\",\n        slug: \"\",\n        genres: [],\n        genre_ids: []\n      },\n      authors: [],\n      imgPath: process.env.VUE_APP_IMAGE_URL,\n      genres: [{\n        value: 1,\n        text: \"Science Fiction\"\n      }, {\n        value: 2,\n        text: \"Fantasy\"\n      }, {\n        value: 3,\n        text: \"Romance\"\n      }, {\n        value: 4,\n        text: \"Thriller\"\n      }, {\n        value: 5,\n        text: \"Mystery\"\n      }, {\n        value: 6,\n        text: \"Horror\"\n      }, {\n        value: 7,\n        text: \"Classic\"\n      }]\n    };\n  },\n  methods: {\n    submitHandler() {\n      const payload = {\n        id: this.book.id,\n        title: this.book.title,\n        author_id: parseInt(this.book.author_id, 10),\n        publication_year: this.book.publication_year,\n        description: this.book.description,\n        cover: this.book.cover,\n        slug: this.book.slug,\n        genre_ids: this.book.genre_ids\n      };\n      fetch(`${process.env.VUE_APP_API_URL}/admin/books/save`, Security.requestOptions(payload)).then(response => response.json()).then(data => {\n        if (data.error) {\n          this.$emit('error', data.message);\n        } else {\n          this.$emit('success', 'Changes saved');\n          router.push(\"/admin/books\");\n        }\n      }).catch(error => {\n        this.$emit('error', error);\n      });\n    },\n    loadCoverImage() {\n      // get a reference to the input using ref\n      const file = this.$refs.coverInput.files[0];\n\n      // encode the file using the FileReader API\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const base64String = reader.result.replace(\"data:\", \"\").replace(/^.+,/, \"\");\n        this.book.cover = base64String;\n        // alert(base64String);\n      };\n      reader.readAsDataURL(file);\n    },\n    confirmDelete(id) {\n      notie.confirm({\n        text: \"Are you sure you want to delete this book?\",\n        submitText: \"Delete\",\n        submitCallback: () => {\n          let payload = {\n            id: id\n          };\n          fetch(process.env.VUE_APP_API_URL + \"/admin/books/delete\", Security.requestOptions(payload)).then(response => response.json()).then(data => {\n            if (data.error) {\n              this.$emit('error', data.message);\n            } else {\n              this.$emit('success', \"Book deleted\");\n              router.push(\"/admin/books\");\n            }\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["Security","FormTag","TextInput","SelectInput","router","notie","name","beforeMount","requireToken","components","data","book","id","title","author_id","publication_year","description","cover","slug","genres","genre_ids","authors","imgPath","process","env","VUE_APP_IMAGE_URL","value","text","methods","submitHandler","payload","parseInt","fetch","VUE_APP_API_URL","requestOptions","then","response","json","error","$emit","message","push","catch","loadCoverImage","file","$refs","coverInput","files","reader","FileReader","onloadend","base64String","result","replace","readAsDataURL","confirmDelete","confirm","submitText","submitCallback"],"sources":["/Users/ed1p_/MovieProject/frontend/src/components/BookEdit.vue"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"row\">\n      <div class=\"col\">\n        <h1 class=\"mt-3\">Add/Edit Book</h1>\n        <hr>\n\n        <form-tag @bookEditEvent=\"submitHandler\" name=\"bookForm\" event=\"bookEditEvent\">\n\n          <div v-if=\"this.book.slug !=''\" class=\"mb-3\">\n            <img :src=\"`${this.imgPath}/covers/${this.book.slug}.jpg`\" class=\"img-fluid img-thumbnail book-cover\" alt=\"cover\">\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"formFile\" class=\"form-label\">Cover Image</label>\n            <input v-if=\"this.book.id === 0\" ref=\"coverInput\" class=\"form-control\" type=\"file\" id=\"formFile\"\n                   required accept=\"image/jpeg\" @change=\"loadCoverImage\">\n            <input v-else ref=\"coverInput\" class=\"form-control\" type=\"file\" id=\"formFile\"\n                   accept=\"image/jpeg\" @change=\"loadCoverImage\">\n          </div>\n\n          <text-input\n              v-model=\"book.title\"\n              type=\"text\"\n              required=\"true\"\n              label=\"Title\"\n              :value=\"book.title\"\n              name=\"title\"></text-input>\n\n          <select-input\n              name=\"author-id\"\n              v-model=\"this.book.author_id\"\n              :items=\"this.authors\"\n              required=\"required\"\n              label=\"Author\"></select-input>\n\n          <text-input\n              v-model=\"book.publication_year\"\n              type=\"text\"\n              required=\"true\"\n              label=\"Publication Year\"\n              :value=\"book.publication_year\"\n              name=\"publication-year\"></text-input>\n\n          <div class=\"mb-3\">\n            <label for=\"description\" class=\"form-label\">Description</label>\n            <textarea required v-model=\"book.description\" class=\"form-control\" id=\"description\" rows=\"3\"></textarea>\n          </div>\n\n          <div class=\"mb-3\">\n            <label for=\"genres\" class=\"form-label\">Genres</label>\n            <select ref=\"genres\"\n                    id=\"genres\"\n                    class=\"form-select\"\n                    required\n                    size=\"7\"\n                    v-model=\"this.book.genre_ids\"\n                    multiple>\n              <option v-for=\"g in this.genres\" :value=\"g.value\" :key=\"g.value\">\n                {{g.text}}\n              </option>\n            </select>\n          </div>\n\n          <hr>\n\n          <div class=\"float-start\">\n            <input type=\"submit\" class=\"btn btn-primary me-2\" value=\"Save\" />\n            <router-link to=\"/admin/books\" class=\"btn btn-outline-secondary\">Cancel</router-link>\n          </div>\n          <div class=\"float-end\">\n            <a v-if=\"this.book.id > 0\"\n               class=\"btn btn-danger\" href=\"javascript:void(0);\" @click=\"confirmDelete(this.book.id)\">\n              Delete\n            </a>\n          </div>\n\n\n\n        </form-tag>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Security from \"@/components/security\";\nimport FormTag from \"@/components/forms/FormTag.vue\";\nimport TextInput from \"@/components/forms/TextInput.vue\";\nimport SelectInput from \"@/components/forms/SelectInput.vue\";\nimport router from \"@/router\";\nimport notie from \"notie/dist/notie\";\n\nexport default {\nname: \"BookEdit\",\nbeforeMount() {\nSecurity.requireToken();\n},\ncomponents: {\n'form-tag': FormTag,\n'text-input': TextInput,\n'select-input': SelectInput,\n},\ndata() {\nreturn {\nbook: {\nid: 0,\ntitle: \"\",\nauthor_id: 0,\npublication_year: 0,\ndescription: \"\",\ncover: \"\",\nslug: \"\",\ngenres: [],\ngenre_ids: [],\n},\nauthors: [],\nimgPath: process.env.VUE_APP_IMAGE_URL,\ngenres: [\n{value: 1, text: \"Science Fiction\"},\n{value: 2, text: \"Fantasy\"},\n{value: 3, text: \"Romance\"},\n{value: 4, text: \"Thriller\"},\n{value: 5, text: \"Mystery\"},\n{value: 6, text: \"Horror\"},\n{value: 7, text: \"Classic\"},\n]\n}\n},\nmethods: {\nsubmitHandler() {\nconst payload = {\nid: this.book.id,\ntitle: this.book.title,\nauthor_id : parseInt(this.book.author_id, 10),\npublication_year: this.book.publication_year,\ndescription: this.book.description,\ncover: this.book.cover,\nslug: this.book.slug,\ngenre_ids: this.book.genre_ids,\n}\n\nfetch(`${process.env.VUE_APP_API_URL}/admin/books/save`, Security.requestOptions(payload))\n.then((response) => response.json())\n.then((data) => {\nif (data.error) {\nthis.$emit('error', data.message)\n} else {\nthis.$emit('success', 'Changes saved');\nrouter.push(\"/admin/books\");\n}\n})\n.catch((error) =>{\nthis.$emit('error', error);\n})\n},\nloadCoverImage() {\n// get a reference to the input using ref\nconst file = this.$refs.coverInput.files[0];\n\n// encode the file using the FileReader API\nconst reader = new FileReader();\nreader.onloadend = () => {\nconst base64String = reader.result\n.replace(\"data:\", \"\")\n.replace(/^.+,/, \"\");\nthis.book.cover = base64String;\n// alert(base64String);\n}\nreader.readAsDataURL(file);\n},\nconfirmDelete(id) {\nnotie.confirm({\ntext: \"Are you sure you want to delete this book?\",\nsubmitText: \"Delete\",\nsubmitCallback: () => {\nlet payload = {\nid: id,\n}\n\nfetch(process.env.VUE_APP_API_URL + \"/admin/books/delete\", Security.requestOptions(payload))\n.then((response) => response.json())\n.then((data) => {\nif (data.error) {\nthis.$emit('error', data.message);\n} else {\nthis.$emit('success', \"Book deleted\");\nrouter.push(\"/admin/books\");\n}\n})\n}\n})\n}\n}\n}\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}